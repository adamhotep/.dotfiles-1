#!/bin/sh

status=$(echo -n $(dbus-send --print-reply  --dest=org.mpris.MediaPlayer2.chrome.instance$(pgrep -x chrome | head -n 1) /org/mpris/MediaPlayer2 org.freedesktop.DBus.Properties.Get string:'org.mpris.MediaPlayer2.Player' string:'PlaybackStatus' | tail -n 1 | cut -c 25- | tr -d \"))

if [[ $status = Playing ]]; then
        title=$(echo -n $(dbus-send --print-reply  --dest=org.mpris.MediaPlayer2.chrome.instance$(pgrep -x chrome | head -n 1) /org/mpris/MediaPlayer2 org.freedesktop.DBus.Properties.Get string:'org.mpris.MediaPlayer2.Player' string:'Metadata' | grep -A 2 title | tail -n 2 | head -1 | cut -c 43- | tr -d \" | rev | cut -c 5- | rev))
        echo -n "$title - "
elif [[ $status = Paused ]]; then
        title=$(echo -n $(dbus-send --print-reply  --dest=org.mpris.MediaPlayer2.chrome.instance$(pgrep -x chrome | head -n 1) /org/mpris/MediaPlayer2 org.freedesktop.DBus.Properties.Get string:'org.mpris.MediaPlayer2.Player' string:'Metadata' | grep -A 2 title | tail -n 2 | head -1 | cut -c 43- | tr -d \" | rev | cut -c 5- | rev))
        echo -n "$title - "
else
        echo
fi

if [[ $1 = "toggle" ]]; then
      dbus-send --print-reply --dest=org.mpris.MediaPlayer2.chrome.instance$(pgrep -x chrome | head -n 1) /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.PlayPause
else
        echo
fi
